# Directory Client Role Auto-Switches Type - Should Preserve Current Type
**Priority:** CRITICAL  
**Type:** Bug Fix  
**Assigned to:** CODE WRITER  
**Status:** TODO

---

## üîç –ü–†–û–ë–õ–ï–ú–ê

### –°–∏–º–ø—Ç–æ–º—ã:
- –ó–∞–ø–∏—Å—å –∏–º–µ–µ—Ç Type = Company, Roles = Supplier –∏–ª–∏ Subagent
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client, Type –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Person
- Type –ù–ï –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ - –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è Company

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ï—Å–ª–∏ Type = Company –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ä–æ–ª—å Client, Type –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è Company
- Client role –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π Type, –∞ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å –µ–≥–æ

---

## üîç –ü–†–ò–ß–ò–ù–ê

**–§–∞–π–ª:** `components/DirectoryForm.tsx`

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è clientType (—Å—Ç—Ä–æ–∫–∏ 76-80)

```typescript
const [clientType, setClientType] = useState<DirectoryType>(
  record?.roles.includes("client")
    ? record.type
    : "person"  // ‚ùå –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é "person"
);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –Ω–µ –∏–º–µ–µ—Ç —Ä–æ–ª—å Client, `clientType` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `"person"` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π Type = "company".

### –ü—Ä–æ–±–ª–µ–º–∞ 2: useEffect –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç baseType (—Å—Ç—Ä–æ–∫–∏ 125-132)

```typescript
useEffect(() => {
  if (roles.includes("client")) {
    setBaseType(clientType);  // ‚ùå –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç baseType –Ω–∞ clientType (–∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å "person")
  } else if (mode === "create") {
    setBaseType(baseType);
  }
}, [roles, clientType, mode, baseType]);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ä–æ–ª—å Client, `setBaseType(clientType)` –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç Type –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ `clientType`, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å "person" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–µ–∫—É—â–∏–π Type –±—ã–ª "company".

**–õ–æ–≥–∏–∫–∞:**
1. –ó–∞–ø–∏—Å—å: Type = Company, Roles = [Supplier]
2. baseType = "company", clientType = "person" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–æ–ª—å Client
4. useEffect —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç: `setBaseType(clientType)` ‚Üí baseType —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è "person"
5. Type –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Person ‚ùå

**–û–∂–∏–¥–∞–µ–º–∞—è –ª–æ–≥–∏–∫–∞:**
1. –ó–∞–ø–∏—Å—å: Type = Company, Roles = [Supplier]
2. baseType = "company", clientType = "person" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–æ–ª—å Client
4. clientType –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Ç–µ–∫—É—â–∏–π baseType ("company")
5. baseType –ù–ï –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω—è—Ç—å—Å—è
6. Type –æ—Å—Ç–∞–µ—Ç—Å—è Company ‚úÖ

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### –§–∞–π–ª: `components/DirectoryForm.tsx`

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è clientType –¥–æ–ª–∂–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π Type

**–ù–∞–π—Ç–∏ (—Å—Ç—Ä–æ–∫–∏ 76-80):**
```typescript
const [clientType, setClientType] = useState<DirectoryType>(
  record?.roles.includes("client")
    ? record.type
    : "person"
);
```

**–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**
```typescript
const [clientType, setClientType] = useState<DirectoryType>(
  record?.roles.includes("client")
    ? record.type
    : (record?.type || "person")  // ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π Type –∑–∞–ø–∏—Å–∏, –µ—Å–ª–∏ –µ—Å—Ç—å
);
```

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 2: useEffect –¥–æ–ª–∂–µ–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å clientType –≤ baseType, –∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç

**–ù–∞–π—Ç–∏ (—Å—Ç—Ä–æ–∫–∏ 125-132):**
```typescript
useEffect(() => {
  if (roles.includes("client")) {
    setBaseType(clientType);  // ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
  } else if (mode === "create") {
    setBaseType(baseType);
  }
}, [roles, clientType, mode, baseType]);
```

**–ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:**
```typescript
useEffect(() => {
  if (roles.includes("client")) {
    // ‚úÖ –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ä–æ–ª—å Client, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º clientType –≤ —Ç–µ–∫—É—â–∏–π baseType
    // –≠—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π Type (Company/Person) –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client
    setClientType(baseType);
  }
  // –£–±—Ä–∞—Ç—å setBaseType - baseType –Ω–µ –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω—è—Ç—å—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client
}, [roles, baseType]);
```

**–ò–ª–∏ –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª):**
```typescript
useEffect(() => {
  if (roles.includes("client") && clientType !== baseType) {
    // ‚úÖ –ö–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ä–æ–ª—å Client, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º clientType –≤ —Ç–µ–∫—É—â–∏–π baseType
    // –≠—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–∫—É—â–∏–π Type (Company/Person) –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client
    setClientType(baseType);
  }
}, [roles, baseType, clientType]);
```

---

## üìä –í–õ–ò–Ø–ù–ò–ï

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client Type –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Person
- ‚ùå –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö: –µ—Å–ª–∏ Type –±—ã–ª Company, –æ–Ω –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ Person
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å Type –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ Company
- ‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ UI

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client Type –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º (Company –∏–ª–∏ Person)
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è: Type –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç—å Type –¥–ª—è —Ä–æ–ª–∏ Client, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ UI

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò

1. ‚úÖ –ó–∞–ø–∏—Å—å Type = Company, Roles = [Supplier] ‚Üí –¥–æ–±–∞–≤–∏—Ç—å Client ‚Üí Type –æ—Å—Ç–∞–µ—Ç—Å—è Company
2. ‚úÖ –ó–∞–ø–∏—Å—å Type = Company, Roles = [Subagent] ‚Üí –¥–æ–±–∞–≤–∏—Ç—å Client ‚Üí Type –æ—Å—Ç–∞–µ—Ç—Å—è Company
3. ‚úÖ –ó–∞–ø–∏—Å—å Type = Person, Roles = [Supplier] ‚Üí –¥–æ–±–∞–≤–∏—Ç—å Client ‚Üí Type –æ—Å—Ç–∞–µ—Ç—Å—è Person
4. ‚úÖ –ó–∞–ø–∏—Å—å Type = Company, Roles = [Client] ‚Üí Type = Company (–Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ Person)
5. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç—å Type –¥–ª—è —Ä–æ–ª–∏ Client —á–µ—Ä–µ–∑ UI
6. ‚úÖ –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client Type –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –®–∞–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. –°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–ø–∏—Å—å: Type = Company, Roles = [Supplier]
2. –î–æ–±–∞–≤–∏—Ç—å —Ä–æ–ª—å Client (—á–µ–∫–±–æ–∫—Å)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: Type –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è Company (–Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ Person)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: –ú–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å Type –Ω–∞ Person, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
5. –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å Client ‚Üí Type –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è –ø—Ä–µ–∂–Ω–∏–º
6. –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è Type = Person, Roles = [Supplier]

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- Type –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client
- Type —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Ä—É—á–Ω—É—é –∏–∑–º–µ–Ω–∏—Ç—å Type –¥–ª—è —Ä–æ–ª–∏ Client

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

- **–í–∞–∂–Ω–æ:** clientType –¥–æ–ª–∂–µ–Ω –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ Type –∑–∞–ø–∏—Å–∏, –µ—Å–ª–∏ —Ä–æ–ª—å Client –Ω–µ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ
- **–í–∞–∂–Ω–æ:** baseType –ù–ï –¥–æ–ª–∂–µ–Ω –∏–∑–º–µ–Ω—è—Ç—å—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client
- **–í–∞–∂–Ω–æ:** clientType –¥–æ–ª–∂–µ–Ω —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å baseType –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–æ–ª–∏ Client
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ó–∞–ø–∏—Å–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –∏–º–µ—é—Ç —Ä–æ–ª—å Client, –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –ø—Ä–µ–∂–¥–µ

---

**Created by:** QA Agent  
**Date:** 2025-12-25  
**Related:** Directory Form, Client Role, Type Selection

