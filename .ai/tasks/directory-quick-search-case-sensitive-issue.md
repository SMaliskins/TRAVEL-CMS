# Directory Quick Search - Case Sensitivity Issue
**Priority:** HIGH  
**Type:** Bug Fix  
**Assigned to:** CODE WRITER  
**Status:** TODO

---

## üîç –ü–†–û–ë–õ–ï–ú–ê

### –°–∏–º–ø—Ç–æ–º—ã:
- Quick Search "Tez" ‚Üí –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç "TEZ TOUR" ‚ùå
- Quick Search "TEZ" ‚Üí –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç "TEZ TOUR" ‚ùå
- Quick Search "tez" ‚Üí –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç "TEZ TOUR" ‚ùå
- Quick Search "test" ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç "TEZ TOUR" –∏ 3 –¥—Ä—É–≥–∏–µ –∑–∞–ø–∏—Å–∏ ‚úÖ

**–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- –ü–æ–∏—Å–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å case-insensitive
- "Tez", "TEZ", "tez" –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å "TEZ TOUR"
- –ü–æ–∏—Å–∫ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ (—á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)

---

## üîç –ü–†–ò–ß–ò–ù–ê

**–§–∞–π–ª:** `app/api/directory/route.ts` (—Å—Ç—Ä–æ–∫–∏ 129-136)

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**
```typescript
if (search) {
  // Use ilike for case-insensitive search (ilike is case-insensitive in PostgreSQL)
  // The .or() method accepts a string with format: "column.ilike.%value%,column2.ilike.%value%"
  // ilike operator is case-insensitive by default in PostgreSQL
  query = query.or(
    `display_name.ilike.%${search}%,email.ilike.%${search}%,phone.ilike.%${search}%`
  );
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `ilike` –≤ PostgreSQL case-insensitive, –Ω–æ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ Supabase –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `.or()` —Å `ilike`
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç –∏–ª–∏ –º–µ—Ç–æ–¥

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- –ó–∞–ø–∏—Å—å "TEZ TOUR" —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- API `/api/directory/21882b7a-f2cf-4573-ad00-967021635419` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `companyName: "TEZ TOUR"`
- –ù–æ `display_name` –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç `company_name`

**–ì–∏–ø–æ—Ç–µ–∑—ã:**
1. –§–æ—Ä–º–∞—Ç `.or()` –∑–∞–ø—Ä–æ—Å–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–ª—è Supabase
2. `display_name` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å "TEZ TOUR" (–º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –¥—Ä—É–≥–æ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç–µ)
3. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–µ–π –ø–æ–∏—Å–∫–∞ (–≤–æ–∑–º–æ–∂–Ω–æ, "Tez" –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å "TEZ TOUR" –∏–∑-–∑–∞ –ø—Ä–æ–±–µ–ª–∞)
4. "test" –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–ø–∏—Å–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏—â–µ—Ç –≤ email/phone, –∞ –Ω–µ –≤ display_name

---

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤ display_name –¥–ª—è –∑–∞–ø–∏—Å–∏ "TEZ TOUR"

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT id, display_name, party_type 
FROM party 
WHERE id = '21882b7a-f2cf-4573-ad00-967021635419';
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ö–∞–∫–æ–π `display_name` —É –∑–∞–ø–∏—Å–∏ "TEZ TOUR"?
- –°–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ `display_name` —Å `company_name`?

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ Supabase

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–æ—Ä–º–∞—Ç `.or()` –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º.

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**
```typescript
query.or(`display_name.ilike.%${search}%,email.ilike.%${search}%,phone.ilike.%${search}%`)
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**

**–í–∞—Ä–∏–∞–Ω—Ç 1:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (–Ω–µ `.or()`)
```typescript
if (search) {
  query = query.or(
    `display_name.ilike.%${search}%,email.ilike.%${search}%,phone.ilike.%${search}%`
  );
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 2:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ PostgreSQL (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)
```typescript
if (search) {
  query = query.or(`display_name.ilike.%${search}%,email.ilike.%${search}%,phone.ilike.%${search}%`);
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 3:** –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ search
```typescript
if (search) {
  const escapedSearch = search.replace(/%/g, '\\%').replace(/_/g, '\\_');
  query = query.or(
    `display_name.ilike.%${escapedSearch}%,email.ilike.%${escapedSearch}%,phone.ilike.%${escapedSearch}%`
  );
}
```

**–í–∞—Ä–∏–∞–Ω—Ç 4:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω)

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–∏—Å–∫ –ø–æ company_name (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–ï—Å–ª–∏ `display_name` –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω–æ–µ –∏–º—è –∫–æ–º–ø–∞–Ω–∏–∏:**
- –î–æ–±–∞–≤–∏—Ç—å JOIN —Å `party_company` –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ `company_name`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥–∑–∞–ø—Ä–æ—Å

---

## üìä –í–õ–ò–Ø–ù–ò–ï

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ü–æ–∏—Å–∫ "Tez" –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç "TEZ TOUR"
- ‚ùå –ü–æ–∏—Å–∫ case-sensitive (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è)
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –Ω–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏ –ø–æ —á–∞—Å—Ç–∏—á–Ω–æ–º—É —Å–æ–≤–ø–∞–¥–µ–Ω–∏—é

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –ü–æ–∏—Å–∫ "Tez" –Ω–∞—Ö–æ–¥–∏—Ç "TEZ TOUR"
- ‚úÖ –ü–æ–∏—Å–∫ case-insensitive
- ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ (—á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–ï–ú–ö–ò

1. ‚úÖ –ü–æ–∏—Å–∫ "Tez" –Ω–∞—Ö–æ–¥–∏—Ç "TEZ TOUR"
2. ‚úÖ –ü–æ–∏—Å–∫ "TEZ" –Ω–∞—Ö–æ–¥–∏—Ç "TEZ TOUR"
3. ‚úÖ –ü–æ–∏—Å–∫ "tez" –Ω–∞—Ö–æ–¥–∏—Ç "TEZ TOUR"
4. ‚úÖ –ü–æ–∏—Å–∫ case-insensitive (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤)
5. ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ (—á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
6. ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Person –∑–∞–ø–∏—Å–µ–π (first name, last name)
7. ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è Company –∑–∞–ø–∏—Å–µ–π (company name)

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –®–∞–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
1. –û—Ç–∫—Ä—ã—Ç—å `/directory`
2. –û—Ç–∫—Ä—ã—Ç—å Quick Search (Cmd+K / Ctrl+K)
3. –í–≤–µ—Å—Ç–∏ "Tez" ‚Üí –¥–æ–ª–∂–Ω–∞ –Ω–∞–π—Ç–∏—Å—å "TEZ TOUR"
4. –í–≤–µ—Å—Ç–∏ "TEZ" ‚Üí –¥–æ–ª–∂–Ω–∞ –Ω–∞–π—Ç–∏—Å—å "TEZ TOUR"
5. –í–≤–µ—Å—Ç–∏ "tez" ‚Üí –¥–æ–ª–∂–Ω–∞ –Ω–∞–π—Ç–∏—Å—å "TEZ TOUR"
6. –í–≤–µ—Å—Ç–∏ "TEZ TOUR" ‚Üí –¥–æ–ª–∂–Ω–∞ –Ω–∞–π—Ç–∏—Å—å "TEZ TOUR"
7. –í–≤–µ—Å—Ç–∏ —á–∞—Å—Ç—å –∏–º–µ–Ω–∏ ‚Üí –¥–æ–ª–∂–Ω–∞ –Ω–∞–π—Ç–∏—Å—å –∑–∞–ø–∏—Å—å
8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ –¥–ª—è Person –∑–∞–ø–∏—Å–µ–π (first name, last name)

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç case-insensitive
- –ü–æ–∏—Å–∫ –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–ø–∏—Å–∏ –ø–æ –ø–æ–¥—Å—Ç—Ä–æ–∫–µ
- –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ

---

## üìù –ü–†–ò–ú–ï–ß–ê–ù–ò–Ø

- **–í–∞–∂–Ω–æ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π `display_name` —É –∑–∞–ø–∏—Å–∏ "TEZ TOUR" –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **–í–∞–∂–Ω–æ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç `.or()` –∑–∞–ø—Ä–æ—Å–∞ –≤ Supabase –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **–í–∞–∂–Ω–æ:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `ilike` —Ä–∞–±–æ—Ç–∞–µ—Ç case-insensitive –≤ Supabase
- **–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –∑–∞–ø—Ä–æ—Å–∞, –≤–æ–∑–º–æ–∂–Ω–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥ Supabase

---

**Created by:** QA Agent  
**Date:** 2025-12-25  
**Related:** Directory Quick Search, TopBar Search, Case Sensitivity

