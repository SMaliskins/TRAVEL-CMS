# –ê–Ω–∞–ª–∏–∑ –∏ –ø–ª–∞–Ω –¥–æ—Ä–∞–±–æ—Ç–∫–∏ —Å–∏—Å—Ç–µ–º—ã —Å—á–µ—Ç–æ–≤ (Invoices)

**–î–∞—Ç–∞:** 2026-01-30  
**–ò—Å—Ç–æ—á–Ω–∏–∫:** –ê–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–∏—Å—Ç–µ–º–µ —Å—á–µ—Ç–æ–≤

---

## 1. –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞ (Invoice Number)

| | |
|---|---|
| **–§–æ—Ä–º–∞—Ç** | 001626-SM-0132 (6 —Ü–∏—Ñ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞ –≥–æ–¥ + –∏–Ω–∏—Ü–∏–∞–ª—ã + 4 —Ü–∏—Ñ—Ä—ã) |
| **–ì–¥–µ** | `app/api/orders/[orderCode]/invoices/route.ts` ‚Äî nextNumber –ø–æ company_id, –º–∞–∫—Å –ø–æ NNNNNN-INITIALS-NNNN –∏ legacy INV-... |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –°–¥–µ–ª–∞–Ω–æ |

---

## 2. –õ–æ–≥–æ—Ç–∏–ø –∏ INVOICE

| | |
|---|---|
| **–ì–¥–µ** | `lib/invoices/generateInvoiceHTML.ts` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ PDF –∏ email |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –°–¥–µ–ª–∞–Ω–æ (–ª–æ–≥–æ –±–µ–∑ —Ä–∞–º–∫–∏; INVOICE –∫—Ä—É–ø–Ω–æ —Å–ø—Ä–∞–≤–∞ —Å–≤–µ—Ä—Ö—É) |

---

## 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã

| | |
|---|---|
| **–¢–µ–∫—É—â–µ–µ** | Date: 02.02.2026 (02.02.2026) ‚Äî –¥–∞—Ç–∞ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è |
| **–ì–¥–µ –º–µ–Ω—è—Ç—å** | InvoiceCreator.tsx –∏ PDF-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –°–¥–µ–ª–∞–Ω–æ (–≤ lib/invoices/generateInvoiceHTML.ts –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ Date) |

---

## 4. –ö–æ–ª–æ–Ω–∫–∞ Service

| | |
|---|---|
| **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ** | –î–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤ (–æ—Ç–µ–ª–∏, —Ç—É—Ä—ã –∏ —Ç.–¥.) –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–æ–ª—è Name —Å–µ—Ä–≤–∏—Å–∞ |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –°–¥–µ–ª–∞–Ω–æ (s.name) |

---

## 5. Client ‚Äî –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã —Å–µ—Ä–≤–∏—Å–∞

| | |
|---|---|
| **–¢–µ–∫—É—â–µ–µ** | –í invoice_items —Ö—Ä–∞–Ω–∏—Ç—Å—è service_client ‚Äî –æ–¥–∏–Ω –∫–ª–∏–µ–Ω—Ç –Ω–∞ —Å—Ç—Ä–æ–∫—É |
| **–ñ–µ–ª–∞–µ–º–æ–µ** | –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ |
| **–ß—Ç–æ –Ω—É–∂–Ω–æ** | –í order_services –µ—Å—Ç—å assignedTravellerIds. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—á—ë—Ç–∞ –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å –∏–º–µ–Ω–∞ –≤—Å–µ—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤; –≤ invoice_items —Ö—Ä–∞–Ω–∏—Ç—å/–æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ (JSON –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞) |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –°–¥–µ–ª–∞–Ω–æ: –ø—Ä–∏ Issue Invoice –≤ selectedServicesData –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ client = —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω –∏–∑ orderTravellers –ø–æ assignedTravellerIds (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é); InvoiceCreator –∏ API –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî service_client –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–æ–∫—É |

---

## 6. Payment Terms ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∞ –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤

| | |
|---|---|
| **–¢–µ–∫—É—â–µ–µ** | Payment Terms –≤ Create Invoice –∑–∞–¥–∞—ë—Ç—Å—è –≤—Ä—É—á–Ω—É—é |
| **–ñ–µ–ª–∞–µ–º–æ–µ** | –ü–æ–¥—Å–∫–∞–∑–∫–∞ –∏–∑ payment_terms –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ |
| **–ì–¥–µ** | InvoiceCreator.tsx ‚Äî –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —á–∏—Ç–∞—Ç—å paymentTerms –∏–∑ currentServices –∏ –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å (–∏–ª–∏ placeholder/hint) |

---

## 7. Notes ‚Äî —É–±—Ä–∞—Ç—å

| | |
|---|---|
| **–ì–¥–µ** | InvoiceCreator.tsx ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ Notes; PDF-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä ‚Äî –±–ª–æ–∫ Notes |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –°–¥–µ–ª–∞–Ω–æ (–ø–æ–ª–µ –∏ –±–ª–æ–∫ —É–±—Ä–∞–Ω—ã; API notes –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |


---

## 8. Final Payment Date ‚Äî –≤–∞—Ä–∏–∞–Ω—Ç—ã

| | |
|---|---|
| **–ñ–µ–ª–∞–µ–º—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã** | 1 –º–µ—Å—è—Ü + 2 –¥–Ω—è –¥–æ –Ω–∞—á–∞–ª–∞ —Å–µ—Ä–≤–∏—Å–∞; 2 –Ω–µ–¥–µ–ª–∏ + 2 –¥–Ω—è –¥–æ –Ω–∞—á–∞–ª–∞ —Å–µ—Ä–≤–∏—Å–∞ |
| **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ** | –° —É—á—ë—Ç–æ–º –≤—ã—Ö–æ–¥–Ω—ã—Ö ‚Äî –ø–µ—Ä–µ–Ω–æ—Å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å |
| **–ì–¥–µ** | InvoiceCreator.tsx ‚Äî –∫–Ω–æ–ø–∫–∏/—Å–µ–ª–µ–∫—Ç–æ—Ä –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞ –¥–∞—Ç—ã —Å —É—á—ë—Ç–æ–º —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π |

---

## 9. Deposit Date ‚Äî —Å–µ–≥–æ–¥–Ω—è / –∑–∞–≤—Ç—Ä–∞ / –ø–æ—Å–ª–µ–∑–∞–≤—Ç—Ä–∞

| | |
|---|---|
| **–ì–¥–µ** | InvoiceCreator.tsx |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –°–¥–µ–ª–∞–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–µ–≥–æ–¥–Ω—è; –∫–Ω–æ–ø–∫–∏ Today, Tomorrow, Day after) |

---

## 9 (–¥–æ–ø). Final Payment = 100% –±–µ–∑ –¥–µ–ø–æ–∑–∏—Ç–∞

| | |
|---|---|
| **–ü—Ä–æ–±–ª–µ–º–∞** | –ü—Ä–∏ 100% –±–µ–∑ –¥–µ–ø–æ–∑–∏—Ç–∞ –≤ –ø–æ–ª–µ Final Payment –≤–≤–æ–¥–∏—Ç—Å—è 100, —Å–∏—Å—Ç–µ–º–∞ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ —Å—É–º–º—É |
| **–†–µ—à–µ–Ω–∏–µ** | –†–∞–∑–ª–∏—á–∞—Ç—å: 100 –≤ "Final Payment Amount (‚Ç¨)" ‚Äî —Å—É–º–º–∞; 100 –≤ "Final Payment (%)" ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç. –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–µ–ø–æ–∑–∏—Ç–∞ –∏ 100% –æ—Å—Ç–∞—Ç–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "Full Payment", –∞ –Ω–µ "Final Payment" |

---

## 10. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç–æ–≤

| | |
|---|---|
| **–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ** | –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –≤ Settings ‚Üí Financial; –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —è–∑—ã–∫–æ–≤. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—á—ë—Ç–∞ ‚Äî –≤—ã–±–æ—Ä —è–∑—ã–∫–∞ |
| **–ì–¥–µ** | Settings (Financial), InvoiceCreator ‚Äî —Å–µ–ª–µ–∫—Ç–æ—Ä —è–∑—ã–∫–∞ |

---

## 11. –°–æ–æ–±—â–µ–Ω–∏–µ "Invoice created successfully!"

| | |
|---|---|
| **–¢–µ–∫—É—â–µ–µ** | alert('‚úÖ Invoice created successfully!') (InvoiceCreator.tsx ~616) |
| **–í–∞—Ä–∏–∞–Ω—Ç—ã** | Toast (react-hot-toast, sonner); –≤—Ä–µ–º–µ–Ω–Ω—ã–π –±–∞–Ω–Ω–µ—Ä –≤–≤–µ—Ä—Ö—É; inline-—Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ —Å—á–µ—Ç–æ–≤ |

---

## 12. Status = Issued –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

| | |
|---|---|
| **–¢–µ–∫—É—â–µ–µ** | –ù–æ–≤—ã–π —Å—á—ë—Ç —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º draft |
| **–ñ–µ–ª–∞–µ–º–æ–µ** | –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è ‚Äî Issued. –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–ª–∏–µ–Ω—Ç—É ‚Äî Issued & Sent. –ó–∞—Ç–µ–º paid, cancelled, overdue |
| **–°—Ç–∞—Ç—É—Å** | –ú–∏–≥—Ä–∞—Ü–∏—è –µ—Å—Ç—å (add_invoice_statuses_issued.sql). –í API/UI –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è draft ‚Äî –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –≤ issued –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. |

---

## 13. Email ‚Äî —Ä–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞

| | |
|---|---|
| **–¢–µ–∫—É—â–µ–µ** | –†–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Resend; HTML —Å—á—ë—Ç–∞ –≤ —Ç–µ–ª–µ –ø–∏—Å—å–º–∞; PDF –≤–ª–æ–∂–µ–Ω–∏–µ (–µ—Å–ª–∏ puppeteer –¥–æ—Å—Ç—É–ø–µ–Ω) |
| **–ß—Ç–æ –µ—Å—Ç—å** | lib/email/sendEmail.ts —Å Resend, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ attachments; email route –≤—ã–∑—ã–≤–∞–µ—Ç sendEmail, generateInvoiceHTML, generatePDFFromHTML |
| **–ù—É–∂–Ω–æ** | (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–º–µ–Ω–∏—Ç—å prompt() –≤ InvoiceList –Ω–∞ –º–æ–¥–∞–ª —Å –ø–æ–ª—è–º–∏ to, subject, message |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –°–¥–µ–ª–∞–Ω–æ (API: Resend + HTML + PDF –≤–ª–æ–∂–µ–Ω–∏–µ). UI –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É prompt() ‚Äî –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –º–æ–¥–∞–ª –ø–æ–∑–∂–µ. |

---

## 14. PDF ‚Äî –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–∞–∫ PDF, –∞ –Ω–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

| | |
|---|---|
| **–¢–µ–∫—É—â–µ–µ** | PDF-—Ä–æ—É—Ç –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ puppeteer –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç application/pdf —Å Content-Disposition: attachment; –∏–Ω–∞—á–µ fallback –Ω–∞ HTML. –ö–ª–∏–µ–Ω—Ç –ø–æ Content-Type —Å–∫–∞—á–∏–≤–∞–µ—Ç .pdf –∏–ª–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç HTML –¥–ª—è –ø–µ—á–∞—Ç–∏. |
| **–°—Ç–∞—Ç—É—Å** | ‚úÖ –°–¥–µ–ª–∞–Ω–æ (generatePDFFromHTML –≤ route; attachment; InvoiceList –∏ Finances –ø—Ä–æ–≤–µ—Ä—è—é—Ç Content-Type) |

---

## 15. –í–∞—Ä–∏–∞–Ω—Ç—ã: –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–µ—Ä–µ–≤—ã–ø–∏—Å–∫–∞

### –°—Ç–∞—Ç—É—Å—ã —Å—á—ë—Ç–∞

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| draft | –ß–µ—Ä–Ω–æ–≤–∏–∫, –º–æ–∂–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å |
| sent | –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—É |
| paid | –û–ø–ª–∞—á–µ–Ω (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω–æ) |
| processed | –û–±—Ä–∞–±–æ—Ç–∞–Ω –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–µ–π |
| cancelled | –ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω |
| overdue | –ü—Ä–æ—Å—Ä–æ—á–µ–Ω |
| replaced | –ó–∞–º–µ–Ω—ë–Ω –¥—Ä—É–≥–∏–º —Å—á—ë—Ç–æ–º (–ø—Ä–∏ –ø–µ—Ä–µ–≤—ã–ø–∏—Å–∫–µ) |

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–µ–∫—É—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã: issued, issued_sent, paid, cancelled, overdue, processed. –í–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å replaced.

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Å—Ç–∞—Ç—É—Å—É

| –°—Ç–∞—Ç—É—Å | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
|--------|----------------|
| draft | –ü–æ–ª–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| sent | –¢–æ–ª—å–∫–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Å –ø–æ–º–µ—Ç–∫–æ–π "Amended") |
| paid | –¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–æ–∫, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É–º–º |
| processed | –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä, –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |

### –ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—á—ë—Ç–∞ —Å –æ–ø–ª–∞—Ç–æ–π:
1. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –æ –ø–µ—Ä–µ–≤–æ–¥–µ –æ–ø–ª–∞—Ç—ã –Ω–∞ –¥–µ–ø–æ–∑–∏—Ç –∑–∞—è–≤–∫–∏ (order deposit)
2. –û–±–Ω–æ–≤–∏—Ç—å orders.amount_paid (—É–º–µ–Ω—å—à–∏—Ç—å –Ω–∞ —Å—É–º–º—É —Å—á—ë—Ç–∞)
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å invoices.status = 'cancelled'
4. –û—Ç–≤—è–∑–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã –æ—Ç —Å—á—ë—Ç–∞ (order_services.invoice_id = null)
5. –î–æ–±–∞–≤–∏—Ç—å –≤ –ª–æ–≥: "Invoice X cancelled. Payment ‚Ç¨Y moved to order deposit."

### –ü–µ—Ä–µ–≤—ã–ø–∏—Å–∫–∞

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Å—á—ë—Ç —Å –Ω–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º
2. –°—Ç–∞—Ä—ã–π —Å—á—ë—Ç: status = 'replaced', replaced_by_invoice_id = <new_id>
3. –í –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–æ–º —Ä–∞–∑–¥–µ–ª–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å: –Ω–æ–≤—ã–π —Å—á—ë—Ç; –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π; —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ä—ã–π —Å—á—ë—Ç
4. –ï—Å–ª–∏ –Ω–∞ —Å—Ç–∞—Ä–æ–º —Å—á—ë—Ç–µ –±—ã–ª–∞ –æ–ø–ª–∞—Ç–∞ ‚Äî –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –Ω–∞ –Ω–æ–≤—ã–π —Å—á—ë—Ç –∏–ª–∏ –Ω–∞ –¥–µ–ø–æ–∑–∏—Ç –∑–∞—è–≤–∫–∏ (–ø–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ)

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** –ü—Ä–∏ –ø–µ—Ä–µ–≤—ã–ø–∏—Å–∫–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–∑—è—Ç—å –Ω–æ–º–µ—Ä–∞ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å—á–µ—Ç–æ–≤ —Å —ç—Ç–æ–π –∑–∞—è–≤–∫–∏.

---

## 16. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| processed_by | user_id |
| processed_at | timestamp |
| accounting_notes | –ó–∞–º–µ—Ç–∫–∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞ |
| replaced_by_invoice_id | –ü—Ä–∏ –ø–µ—Ä–µ–≤—ã–ø–∏—Å–∫–µ |
| cancellation_reason | –ü—Ä–∏ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ |
| payment_moved_to_deposit | –§–ª–∞–≥/—Å—É–º–º–∞ –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ –æ–ø–ª–∞—Ç—ã –Ω–∞ –¥–µ–ø–æ–∑–∏—Ç |

---

## 17. –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞

–ü—Ä–∏ –ø–µ—Ä–µ–≤—ã–ø–∏—Å–∫–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å:
- **changes_summary:** JSON —Å amount_before, amount_after, items_changed, dates_changed
- –ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ **invoice_revisions** —Å –∏—Å—Ç–æ—Ä–∏–µ–π –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## 18. –†–µ–∑—é–º–µ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### ‚úÖ –£–∂–µ —Å–¥–µ–ª–∞–Ω–æ (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ –∫–æ–¥—É)
- –°—Ç–∞—Ç—É—Å—ã –≤ –ë–î: issued, issued_sent, paid, cancelled, overdue, processed (–º–∏–≥—Ä–∞—Ü–∏—è add_invoice_statuses_issued.sql)
- Service column: s.name (–≤ PDF –∏ items)
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã: —É–±—Ä–∞–Ω–æ (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ Date –≤ generateInvoiceHTML)
- Notes: —É–±—Ä–∞–Ω–æ (InvoiceCreator, PDF route –∏ lib; API notes –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Client: –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –∏–∑ assignedTravellerIds (OrderServicesBlock ‚Üí clientNames –≤ selectedServicesData)
- Finances PDF: fix URL ‚Äî invoice.order_code (app/finances/invoices/page.tsx)
- –ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º –æ–ø–ª–∞—Ç—ã –Ω–∞ –¥–µ–ø–æ–∑–∏—Ç (API + UI –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/—Å–æ–æ–±—â–µ–Ω–∏–µ)
- Email: —Ä–µ–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ Resend, HTML + PDF –≤–ª–æ–∂–µ–Ω–∏–µ (sendEmail —Å attachments; email route)
- PDF: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (generatePDFFromHTML –≤ route), Content-Disposition attachment; fallback HTML; –∫–ª–∏–µ–Ω—Ç –ø–æ Content-Type

### üî¥ Critical
- –ù–æ–º–µ—Ä —Å—á—ë—Ç–∞: ‚úÖ –°–¥–µ–ª–∞–Ω–æ (—Ñ–æ—Ä–º–∞—Ç 001626-SM-0132: 6 —Ü–∏—Ñ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ + –∏–Ω–∏—Ü–∏–∞–ª—ã + 4 —Ü–∏—Ñ—Ä—ã; API nextNumber; –ø–æ–¥–¥–µ—Ä–∂–∫–∞ legacy INV-...)
- Email: ‚úÖ –°–¥–µ–ª–∞–Ω–æ
- PDF: ‚úÖ –°–¥–µ–ª–∞–Ω–æ

### üü† High
- Payment Terms: ‚úÖ –°–¥–µ–ª–∞–Ω–æ (–ø–æ–¥—Å–∫–∞–∑–∫–∞ "From services: ‚Ä¶" –∏–∑ paymentTerms –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)
- Deposit Date: ‚úÖ –°–¥–µ–ª–∞–Ω–æ
- Final Payment Date: ‚úÖ –°–¥–µ–ª–∞–Ω–æ (–∫–Ω–æ–ø–∫–∏ "1 mo + 2 d before", "2 wk + 2 d before" –æ—Ç –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ —Å–µ—Ä–≤–∏—Å–∞)
- Full Payment: ‚úÖ –°–¥–µ–ª–∞–Ω–æ (–ø—Ä–∏ 100% –±–µ–∑ –¥–µ–ø–æ–∑–∏—Ç–∞ ‚Äî –ª–µ–π–±–ª—ã "Full Payment (100%)", "Full Payment Date", "Full Payment:" –≤ –ø—Ä–µ–≤—å—é)
- –õ–æ–≥–æ—Ç–∏–ø –∏ INVOICE: ‚úÖ –°–¥–µ–ª–∞–Ω–æ

### üü° Medium
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è: Settings ‚Üí Financial, –≤—ã–±–æ—Ä —è–∑—ã–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- Toast –≤–º–µ—Å—Ç–æ alert: ‚úÖ –°–¥–µ–ª–∞–Ω–æ (–∑–µ–ª—ë–Ω—ã–π –±–∞–Ω–Ω–µ—Ä "Invoice created successfully!" –≤ –º–æ–¥–∞–ª–∫–µ, –∑–∞—Ç–µ–º onClose —á–µ—Ä–µ–∑ 1.5 —Å)
- –ü–µ—Ä–µ–≤—ã–ø–∏—Å–∫–∞: replaced, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–æ–º–µ—Ä–∞ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö

### üü¢ Low
- –î–æ–ø. –ø–æ–ª—è: accounting_notes, replaced_by_invoice_id, cancellation_reason, payment_moved_to_deposit
- invoice_revisions / changes_summary
