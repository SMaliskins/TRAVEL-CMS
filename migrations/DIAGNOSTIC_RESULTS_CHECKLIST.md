# –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## ‚úÖ –ß—Ç–æ —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:

- **ALL COMPANIES**: –í —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å 1 –∫–æ–º–ø–∞–Ω–∏—è
  - ID: `ca0143be-0696-4422-b949-4f4119adef36`
  - Name: `Default Company`
  - Created: `2025-12-24 19:37:01`

## üîç –ß—Ç–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–ª—å—à–µ:

### 1. RECORD 1 - EXISTS CHECK
**–ó–∞–ø–∏—Å—å:** `4642eea4-38ed-464d-866c-3d2bea38235e` (Gulliver Travel)

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- `result`: `‚úÖ EXISTS` –∏–ª–∏ `‚ùå NOT FOUND`
- `count`: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `1` –µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, `0` –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

**–ï—Å–ª–∏ `‚ùå NOT FOUND`:**
- –ó–∞–ø–∏—Å—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–∞–∑–µ
- **–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–ø–∏—Å—å –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å
- **–†–µ—à–µ–Ω–∏–µ:** –ù—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å

### 2. RECORD 1 - PARTY DATA
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- `party_type`: –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `company`
- `status`: –æ–±—ã—á–Ω–æ `active`
- **`company_id`**: ‚ö†Ô∏è **–í–ê–ñ–ù–û!** –î–æ–ª–∂–µ–Ω –±—ã—Ç—å `ca0143be-0696-4422-b949-4f4119adef36` (Default Company)
- `display_name`: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å "Gulliver Travel" –∏–ª–∏ –ø–æ—Ö–æ–∂–µ–µ

**–ï—Å–ª–∏ `company_id` –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è:**
- –≠—Ç–æ **tenant isolation –ø—Ä–æ–±–ª–µ–º–∞**!
- API —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ `company_id`, –∏ –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç - –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ—Ç—Å—è

### 3. RECORD 1 - TENANT CHECK
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- `party_company_id`: –î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∫–æ–º–ø–∞–Ω–∏–µ–π –∏–∑ ALL COMPANIES
- `all_user_companies`: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö `company_id`

**–ö—Ä–∏—Ç–∏—á–Ω–æ:**
- –ï—Å–ª–∏ `party_company_id` ‚â† `company_id` —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –∑–∞–ø–∏—Å—å –Ω–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å `company_id = ca0143be-0696-4422-b949-4f4119adef36`

### 4. RECORD 2 - EXISTS CHECK
**–ó–∞–ø–∏—Å—å:** `5bbdd5f0-2d4f-4e7b-86d1-13940e95fde6`

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- `result`: `‚úÖ EXISTS` –∏–ª–∏ `‚ùå NOT FOUND`
- –ï—Å–ª–∏ `‚ùå NOT FOUND` - –∑–∞–ø–∏—Å—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### 5. ALL USERS - TENANT INFO
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å `company_id = ca0143be-0696-4422-b949-4f4119adef36`
- –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥—Ä—É–≥–æ–π `company_id` –∏–ª–∏ `NULL` ‚Üí –ø—Ä–æ–±–ª–µ–º–∞!

---

## üéØ –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (NOT FOUND)
**–°–∏–º–ø—Ç–æ–º—ã:**
- EXISTS CHECK –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `‚ùå NOT FOUND`
- `count = 0`

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞ –∏–ª–∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å
- –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ (–Ω–µ –ø–æ–∫–∞–∑–∞–ª–∞—Å—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–æ–∑–¥–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Tenant Isolation (–ó–∞–ø–∏—Å—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è)
**–°–∏–º–ø—Ç–æ–º—ã:**
- EXISTS CHECK –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `‚úÖ EXISTS`
- `party.company_id ‚â† profiles.company_id` —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–∏—á–∏–Ω–∞:**
- API —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ `company_id` (tenant isolation)
- –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞ —Å –¥—Ä—É–≥–∏–º `company_id`

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
SELECT user_id, company_id 
FROM public.profiles 
WHERE user_id = auth.uid();

-- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å (–¢–û–õ–¨–ö–û –µ—Å–ª–∏ —É–≤–µ—Ä–µ–Ω—ã!)
UPDATE public.party 
SET company_id = 'ca0143be-0696-4422-b949-4f4119adef36'
WHERE id = '4642eea4-38ed-464d-866c-3d2bea38235e';
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ company_id
**–°–∏–º–ø—Ç–æ–º—ã:**
- –í ALL USERS –≤–∏–¥–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å `company_id = NULL`

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–≤—è–∑—å —Å –∫–æ–º–ø–∞–Ω–∏–µ–π

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é Default Company
UPDATE public.profiles 
SET company_id = 'ca0143be-0696-4422-b949-4f4119adef36'
WHERE user_id = auth.uid() AND company_id IS NULL;
```

---

## üìä –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞:

–ü—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–ª–µ–¥—É—é—â–∏—Ö —Å–µ–∫—Ü–∏–π:

1. **RECORD 1 - EXISTS CHECK**
   - result: ?
   - count: ?

2. **RECORD 1 - PARTY DATA** (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
   - display_name: ?
   - party_type: ?
   - company_id: ?
   - status: ?

3. **RECORD 1 - TENANT CHECK**
   - party_company_id: ?
   - party_company_name: ?

4. **ALL USERS - TENANT INFO**
   - –°–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?
   - –í—Å–µ –ª–∏ –∏–º–µ—é—Ç company_id = `ca0143be-0696-4422-b949-4f4119adef36`?

5. **RECORD 2 - EXISTS CHECK**
   - result: ?
   - count: ?

---

**–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö —è —Å–º–æ–≥—É —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É –ø—Ä–æ–±–ª–µ–º—ã!**

